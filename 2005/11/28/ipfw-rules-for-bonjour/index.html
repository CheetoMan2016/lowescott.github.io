<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      ipfw Rules for Bonjour &middot; Scott&#39;s Weblog
    
  </title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/syntax.css">
  <link rel="stylesheet" href="/css/lanyon.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700|PT+Sans:400">

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/assets/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/assets/favicon.ico">

  
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">


<div class="sidebar" id="sidebar">

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item " href="/">Home</a>
    <a class="sidebar-nav-item " href="/post">Posts</a>

    
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
        <a class="sidebar-nav-item " href="http://lowescott.github.io/about/">About</a>
      
    
      
        <a class="sidebar-nav-item " href="http://lowescott.github.io/learning-nvp-nsx/">Learning NVP/NSX</a>
      
    

    <a class="sidebar-nav-item" href="https://github.com/lowescott.zip">My GitHub</a>
    <a class="sidebar-nav-item" href="https://twitter.com/scott_lowe">My Twitter</a>
  </nav>

  <div class="sidebar-item">
    <p>&copy; 2014. Unless otherwise noted, all content on this site is licensed under a <a href="http://creativecommons.org/licenses/by-sa/3.0/us/">Creative Commons Attribution-Share Alike 3.0 United States License</a>.</p>
    
    <p><img alt="Creative Commons License" src="/assets/cc-by-sa.png" /></p>
  </div>
</div>


    
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Scott&#39;s Weblog</a>
            <small>The weblog of an IT pro specializing in virtualization, networking, cloud computing, &amp; Macs</small>
          </h3>
        </div>
      </div>

      <div class="container content">


<div class="post">
  <h1 class="post-title">ipfw Rules for Bonjour</h1>
  <span class="post-date">Nov 28, 2005 4:11 PM</span>
  <p>I originally published this information on my business website, but thought I&rsquo;d reproduce it here in the event someone needs it.</p>

<p>Apple&rsquo;s <a href="http://www.apple.com/macosx/features/bonjour/">Bonjour</a> (formerly Rendezvous) auto-discovery service is used in a number of Apple-branded products as well as a growing number of third-party applications (for example, my HP Color LaserJet 2550N supports Bonjour). It&rsquo;s used to advertise and discover <a href="http://www.apple.com/itunes/">iTunes</a> music libraries, and Apple&rsquo;s Airport Admin Utility also uses Bonjour to discover <a href="http://www.apple.com/airportextreme/">Airport Extreme</a> and <a href="http://www.apple.com/airportexpress/">Airport Express</a> wireless base stations for configuration.</p>

<p>Bonjour uses <a href="http://www.multicastdns.org/">multicast DNS</a> (known as mDNS), part of the IETF standard known as <a href="http://www.zeroconf.org/">Zeroconf</a>.</p>

<p>All that is well and good, but if you are using the built-in firewall you most likely are preventing Bonjour from working correctly. I grew frustrated trying to utilize Bonjour-related services while also keeping my <a href="http://www.apple.com/powerbook/">PowerBook</a> protected against unwanted network traffic. Using a packet sniffer and Brian Hill&rsquo;s <a href="http://personalpages.tds.net/~brian_hill/brickhouse.html">Brickhouse</a> application, I observed Bonjour traffic and created a set of ipfw rules that can be used to allow this traffic.</p>

<p>Multicast DNS operates over UDP (IP protocol 17) with a destination port 5353 and a source port above 1024. The destination address is, of course, a multicast address (in the 224.0.0.0 range). Responses to mDNS multicasts originate from UDP port 5353, but are bound for a random high port above 1024. Simply defining a rule that allows traffic to and from UDP port 5353 wont work, because while outbound traffic will be correctly matched the responses to those outbound requests wont be matched and will be dropped (assuming the default action is to deny traffic). So, a sample rule to be added to ipfw might look something like this:</p>

<p><code>add 2008 allow udp from 10.1.1.0/24 5353 to any 1024-65535 in via en0</code></p>

<p>(This should be entered all on a single line.)</p>

<p>This rule allows traffic from the source network 10.1.1.0 (the &ldquo;/24&rdquo; indicating a 24-bit mask, i.e., a subnet mask of 255.255.255.0) from UDP source port 5353 to any port above 1024 on any destination address inbound via the en0 interface. The en0 interface is typically the built-in Ethernet interface on most <a href="http://www.apple.com/macosx/">Mac OS X</a>-based systems. (Likewise, en1 is typically the built-in AirPort/AirPort Extreme wireless interface.)</p>

<p>If you are tightly restricting outbound traffic as well, you&rsquo;ll need a matching outbound rule (of course).</p>

<p>My own experience has shown that adding this rule to my ipfw ruleset has allowed Bonjour to work as expected without sacrificing the security of my system.</p>

</div>

      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

  </body>
</html>


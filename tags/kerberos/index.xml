<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Scott&#39;s Weblog </title>
    <link>http://lowescott.github.io/tags/kerberos/index.xml/</link>
    <language>en-us</language>
    <author>Scott Lowe</author>
    <rights>(C) 2005</rights>
    <updated>2005-12-22 11:26:46 &#43;0000 &#43;0000</updated>

    
      
        <item>
          <title>Complete Linux-AD Authentication Details</title>
          <link>http://lowescott.github.io/2005/12/22/complete-linux-ad-authentication-details/</link>
          <pubDate>Thu, 22 Dec 2005 11:26:46 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/12/22/complete-linux-ad-authentication-details/</guid>
          <description>

&lt;p&gt;&lt;strong&gt;UPDATE:&lt;/strong&gt; These instructions are for Windows 2000 Server and Windows Server 2003 pre-R2. For the R2 release, please see &lt;a href=&#34;http://blog.scottlowe.org/2007/01/15/linux-ad-integration-version-4/&#34;&gt;these updated instructions&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;There are several articles posted here that discuss, in general terms, how to authenticate Linux against Active Directory. For example, see this brief article on the &lt;a href=&#34;http://blog.scottlowe.org/2005/07/13/linux-ad-integration-direction/&#34;&gt;broad direction&lt;/a&gt; of the integration, or this posting on &lt;a href=&#34;http://blog.scottlowe.org/2005/07/18/minor-linux-ad-hiccup-fixed-hopefully/&#34;&gt;using computer accounts&lt;/a&gt; for Linux servers (most how-to documents I&amp;rsquo;ve seen discuss the use of a user account for this purpose).&lt;/p&gt;

&lt;p&gt;Over the last week or so, I&amp;rsquo;ve been having to rebuild one Linux server a number of times in an effort to fix a separate problem (see this article on &lt;a href=&#34;http://blog.scottlowe.org/2005/08/16/strange-ntpd-problem-on-centos-41/&#34;&gt;NTPd problems with CentOS 4.1&lt;/a&gt; and the &lt;a href=&#34;http://blog.scottlowe.org/2005/12/19/ntpd-on-centos-42/&#34;&gt;recurrence of the problem&lt;/a&gt; with CentOS 4.2). As a result, I&amp;rsquo;ve had to go through the process of configuring this Linux server (and preparing Active Directory) for authentication several times, and I found that I kept having to go back to my scattered and dispersed notes to remember what had to be done. In the hopes of correcting that, I am collecting all the pertinent information I have here in this article.&lt;/p&gt;

&lt;h3 id=&#34;toc_0&#34;&gt;Preparing Active Directory (One-Time)&lt;/h3&gt;

&lt;p&gt;There is a one-time preparation of Active Directory that is required. In order to authenticate Linux logins against Active Directory, Active Directory&amp;rsquo;s schema must be extended to include Linux-specific attributes such as home directory, UID, GID, and default shell. There are a couple of different ways to do this; I chose to use Microsoft&amp;rsquo;s Services for Unix (SFU) to extend the schema. There are two reasons I chose SFU: 1) it&amp;rsquo;s free; and 2) the SFU schema is being included by default in Windows Server 2003 R2.&lt;/p&gt;

&lt;p&gt;Once SFU has been installed and the schema has been extended, then the specific Active Directory accounts that are allowed to authenticate via Linux must be configured with a UID and other UNIX attributes. This is accomplished via the new &amp;ldquo;UNIX Attributes&amp;rdquo; tab on the properties dialog box of a user account.&lt;/p&gt;

&lt;p&gt;You&amp;rsquo;ll also need to create an account in Active Directory that will be used to bind to Active Directory for LDAP queries. This account does &lt;em&gt;not&lt;/em&gt; need any special privileges; in fact, making the account a member of Domain Guests and &lt;em&gt;not&lt;/em&gt; a member of Domain Users is perfectly fine.&lt;/p&gt;

&lt;p&gt;After all the user accounts have been configured, then we are ready to perform the additional tasks within Active Directory and on the Linux server that will enable the authentication.&lt;/p&gt;

&lt;h3 id=&#34;toc_1&#34;&gt;Preparing Active Directory (Each Server)&lt;/h3&gt;

&lt;p&gt;For each server that will be authenticating against Active Directory, follow the steps below.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Create a computer account in Active Directory. When creating the computer account, be sure to specify that this account may be used by a pre-Windows 2000-based computer.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Use the following command at a command prompt to configure the new computer account:&lt;/p&gt;

&lt;p&gt;ktpass -princ host/fqdn@REALM -mapuser DOMAIN\name$&lt;br /&gt;
-crypto DES-CBC-MD5 -pass password -ptype KRB5_NT_PRINCIPAL&lt;br /&gt;
-out filename&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Of course, you&amp;rsquo;ll need to substitute the appropriate values for &amp;ldquo;fqdn&amp;rdquo; (the fully-qualified domain name of the computer), &amp;ldquo;REALM&amp;rdquo; (the DNS name of your Active Directory domain in UPPERCASE), &amp;ldquo;DOMAIN&amp;rdquo; (the NetBIOS name of your Active Directory domain), &amp;ldquo;password&amp;rdquo; (the password that will be set for the new computer account), and &amp;ldquo;filename&amp;rdquo; (the keytab that will be generated and must be copied over to the Linux computer).&lt;/p&gt;

&lt;p&gt;If you need to rebuild the Linux server for whatever reason, you&amp;rsquo;ll need to delete the computer account you created and repeat this process.&lt;/p&gt;

&lt;h3 id=&#34;toc_2&#34;&gt;Preparing the Linux Server&lt;/h3&gt;

&lt;p&gt;Follow the steps below to configure the Linux server for authentication against Active Directory.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;Make sure that the appropriate Kerberos libraries, OpenLDAP, pam_krb5, and nss_ldap are installed. If they are not installed, install them.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Be sure that time is being properly synchronized between Active Directory and the Linux server in question. Kerberos requires time synchronization.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Edit the &lt;code&gt;krb5.conf&lt;/code&gt; file to look something like this, substituting your actual host names and domain names where appropriate:&lt;/p&gt;

&lt;p&gt;[logging]&lt;br /&gt;
 default = FILE:/var/log/krb5libs.log&lt;br /&gt;
 kdc = FILE:/var/log/krb5kdc.log&lt;br /&gt;
 admin_server = FILE:/var/log/kadmind.log&lt;/p&gt;

&lt;p&gt;[libdefaults]&lt;br /&gt;
 default_realm = EXAMPLE.COM&lt;br /&gt;
 dns_lookup_realm = true&lt;br /&gt;
 dns_lookup_kdc = true&lt;/p&gt;

&lt;p&gt;[realms]&lt;br /&gt;
 EXAMPLE.COM = {&lt;br /&gt;
  kdc = host.example.com:88&lt;br /&gt;
  admin_server = host.example.com:749&lt;br /&gt;
  default_domain = example.com&lt;br /&gt;
 }&lt;/p&gt;

&lt;p&gt;[domain_realm]&lt;br /&gt;
 .example.com = EXAMPLE.COM&lt;br /&gt;
 example.com = EXAMPLE.COM&lt;/p&gt;

&lt;p&gt;[kdc]&lt;br /&gt;
 profile = /var/kerberos/krb5kdc/kdc.conf&lt;/p&gt;

&lt;p&gt;[appdefaults]&lt;br /&gt;
 pam = {&lt;br /&gt;
   debug = false&lt;br /&gt;
   ticket_lifetime = 36000&lt;br /&gt;
   renew_lifetime = 36000&lt;br /&gt;
   forwardable = true&lt;br /&gt;
   krb4_convert = false&lt;br /&gt;
 }&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Edit the &lt;code&gt;/etc/ldap.conf&lt;/code&gt; file to look something like this, substituting the appropriate host names, domain names, account names, and distinguished names (DNs) where appropriate.&lt;/p&gt;

&lt;p&gt;host 10.10.10.10
base dc=example,dc=com
binddn cn=ldap,cn=Users,dc=example,dc=com
bindpw adldapbindpw
scope sub
ssl no
nss_base_passwd dc=example,dc=com
nss_base_shadow dc=example,dc=com
nss_base_group dc=example,dc=com
nss_map_objectclass posixAccount user
nss_map_objectclass shadowAccount user
nss_map_objectclass posixGroup group
nss_map_attribute uid sAMAccountName
nss_map_attribute uidNumber msSFU30UidNumber
nss_map_attribute gidNumber msSFU30GidNumber
nss_map_attribute loginShell msSFU30LoginShell
nss_map_attribute gecos name
nss_map_attribute userPassword msSFU30Password
nss_map_attribute homeDirectory msSFU30HomeDirectory
nss_map_attribute uniqueMember msSFU30PosixMember
nss_map_attribute cn cn&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Securely copy the file created using the &lt;code&gt;ktpass.exe&lt;/code&gt; utility above to the Linux server in question, placing it in the &lt;code&gt;/etc&lt;/code&gt; directory as &lt;code&gt;krb5.keytab&lt;/code&gt;. (SFTP or SCP are excellent candidates for this.)&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Configure PAM (this varies according to Linux distributions) to use pam_krb5 for authentication. Many modern distributions use a stacking mechanism whereby one file can be modified and those changes will applied to all the various PAM-aware services. For example, in Red Hat-based distributions, the system-auth file is referenced by most other PAM-aware services.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Edit the &lt;code&gt;/etc/nsswitch.conf&lt;/code&gt; file to include &amp;ldquo;ldap&amp;rdquo; as a lookup source for passwd, shadow, and groups.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;That should be it. Once you do that, you should be able to use &lt;code&gt;kinit&lt;/code&gt; from a Linux shell prompt (for example, &lt;code&gt;kinit aduser&lt;/code&gt;) and generate a valid Kerberos ticket for the specified Active Directory account.&lt;/p&gt;

&lt;p&gt;At this point, any PAM-aware service that is configured to use the stacked system file (such as the system-auth configuration on Red Hat-based distributions) will use Active Directory for authentication. Note, however, that unless you also add the &lt;code&gt;pam_mkhomedir.so&lt;/code&gt; module in the PAM configuration, home directories will have to be created manually for any Active Directory account that may log on to that server. (I generally recommend the use of &lt;code&gt;pam_mkhomedir.so&lt;/code&gt; in this situation.)&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Next Integration Task(s)</title>
          <link>http://lowescott.github.io/2005/07/24/next-integration-tasks/</link>
          <pubDate>Sun, 24 Jul 2005 23:58:13 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/24/next-integration-tasks/</guid>
          <description>&lt;p&gt;With the majority of my Linux servers now authenticating against Active Directory, I&amp;rsquo;m now able to broaden my integration focus and work on some related tasks:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;em&gt;SASL2/PAM:&lt;/em&gt; I still have one server, running SASL2, that has not been switched over to the standard Kerberos/LDAP configuration. I&amp;rsquo;ll need to research the interplay between SASL2 and PAM before I tackle this one.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;em&gt;OpenBSD Authentication:&lt;/em&gt; I haven&amp;rsquo;t touched any of the OpenBSD servers yet for Kerberos/LDAP authentication.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;em&gt;VPN Authentication via RADIUS:&lt;/em&gt; I&amp;rsquo;d like to use RADIUS to handle some VPN authentication against Active Directory as well. I don&amp;rsquo;t anticipate this should be too terribly difficult, but it is something that is rather new to me.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;em&gt;Apache Authentication via Kerberos to AD:&lt;/em&gt; One of the documents that helped me in getting the pam_krb5 stuff working was for &lt;a href=&#34;http://www.grolmsnet.de/kerbtut/&#34;&gt;using mod_auth_kerb with Apache&lt;/a&gt; (more information also posted &lt;a href=&#34;http://sl.mvps.org/docs/LinuxApacheKerberosAD.htm&#34;&gt;here&lt;/a&gt; as well). I&amp;rsquo;d like to deploy this for some select areas of our intranet and extranet sites, to add an additional layer of security on top of what is already present.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Of course, this is in addition to trying to establish an internal news server running INNd (and then migrating content from Exchange Server 2003 into this news server) and working on Squid log analysis tools. I&amp;rsquo;ll probably start investigating Squid authentication options as well, since that would be very helpful to my customers (especially if I can get the authentication to be transparent, or very nearly so). On top of that I have duties in church, work as a manager overseeing employees, and things to do as a dad. Whew! I often wonder if I am just not efficient with managing my time, or if I just have too much to do.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Linux-AD Integration Wrap-Up</title>
          <link>http://lowescott.github.io/2005/07/22/linux-ad-integration-wrap-up/</link>
          <pubDate>Fri, 22 Jul 2005 00:19:08 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/22/linux-ad-integration-wrap-up/</guid>
          <description>&lt;p&gt;Well, my Linux-AD integration task is pretty much complete. I have three Linux servers authenticating via &lt;a href=&#34;http://web.mit.edu/kerberos/www&#34;&gt;Kerberos&lt;/a&gt; to Active Directory, and using LDAP for name/group resolution. Only one Linux server remains; I need to do some research on how &lt;a href=&#34;http://asg.web.cmu.edu/sasl/&#34;&gt;SASL&lt;/a&gt; with interact with PAM before I can switch over that particular server. My &lt;a href=&#34;http://www.openbsd.org&#34;&gt;OpenBSD&lt;/a&gt; server I&amp;rsquo;m going to leave alone for now; perhaps later I&amp;rsquo;ll get it integrated as well.&lt;/p&gt;

&lt;p&gt;Next, I think I&amp;rsquo;m going to see what is involved in using RADIUS to authenticate VPN tunnels on my hardware firewall.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Computer Accounts With ktpass.exe</title>
          <link>http://lowescott.github.io/2005/07/19/computer-accounts-with-ktpassexe/</link>
          <pubDate>Tue, 19 Jul 2005 13:08:06 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/19/computer-accounts-with-ktpassexe/</guid>
          <description>&lt;p&gt;As a quick follow-up to my previous posting, testing with Kerberos authentication from a Linux server with pam_krb5 was successful. Instead of using a user account in Active Directory to generate the keytab, I was able to use a computer account and just had to modify the ktpass.exe command line syntax slightly (see my previous post).&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Minor Linux-AD Hiccup Fixed (Hopefully)</title>
          <link>http://lowescott.github.io/2005/07/18/minor-linux-ad-hiccup-fixed-hopefully/</link>
          <pubDate>Mon, 18 Jul 2005 00:18:41 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/18/minor-linux-ad-hiccup-fixed-hopefully/</guid>
          <description>&lt;p&gt;I think I have resolved one minor Linux-AD integration hiccup. In setting up the Kerberos authentication, various instructions I had found (including some from Microsoft) indicated I needed to create a &lt;em&gt;user&lt;/em&gt; account for the Linux servers, then use &lt;code&gt;ktpass&lt;/code&gt; to generate the Kerberos keytab. This works, but being the stickler for detail that I am, I really wanted to use a computer account instead of a user account.&lt;/p&gt;

&lt;p&gt;After fiddling with it for a while, I finally managed to make it work. The &lt;code&gt;ktpass&lt;/code&gt; command should look something like this:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;ktpass -princ host/fqdn@REALM -mapuser DOMAIN\name$  
-crypto DES-CBC-MD5 -pass password -ptype KRB5_NT_PRINCIPAL  
-out filename
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The missing piece, for me, was specifying &lt;code&gt;DOMAIN\name$&lt;/code&gt; for the mapuser parameter. Without it, the command kept generating an error.&lt;/p&gt;

&lt;p&gt;I don&amp;rsquo;t know for sure that this will work, but I will be testing this within the next day or so to see how it goes.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Linux-AD Integration Success!</title>
          <link>http://lowescott.github.io/2005/07/17/linux-ad-integration-success/</link>
          <pubDate>Sun, 17 Jul 2005 22:31:52 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/17/linux-ad-integration-success/</guid>
          <description>&lt;p&gt;Well, limited success, anyway. I have managed to get Linux authentication to occur via &lt;a href=&#34;http://web.mit.edu/kerberos/www&#34;&gt;Kerberos&lt;/a&gt; against Active Directory. LDAP is used to lookup the user and group information. Using pam_krb5, authentication occurs via Kerberos to an Active Directory DC for any PAM-aware application. I&amp;rsquo;m sure that I&amp;rsquo;ll find some hiccups along the way, but so far things look good. I only have 1 server configured this way for now (a non-essential server), but after some additional testing I&amp;rsquo;ll expand this to the remainder of my Linux servers.&lt;/p&gt;

&lt;p&gt;I&amp;rsquo;ll post more details here and/or on the &lt;a href=&#34;http://www.mercurionsystems.com/index.html&#34;&gt;Mercurion Systems&lt;/a&gt; web site once all the bugs have been worked out. My thanks go out to the many, many individuals who posted information on using Kerberos and LDAP with Active Directory; this would not have been possible without their assistance.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>Linux-AD Integration Direction</title>
          <link>http://lowescott.github.io/2005/07/13/linux-ad-integration-direction/</link>
          <pubDate>Wed, 13 Jul 2005 17:09:06 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/13/linux-ad-integration-direction/</guid>
          <description>&lt;p&gt;I&amp;rsquo;ve spent some time over the last few days researching some of the various ways in which to allow users to login to Linux servers using their credentials from Active Directory. Along the way, I&amp;rsquo;ve found some useful articles; notably, &lt;a href=&#34;http://www.networkcomputing.com/1305/1305ws1.html&#34;&gt;here&lt;/a&gt;, &lt;a href=&#34;http://www.timkennedy.net/docs/Linux+Active_Directory.html&#34;&gt;here&lt;/a&gt;, and &lt;a href=&#34;http://www.newsforge.com/article.pl?sid=04/12/09/2258243&#34;&gt;here&lt;/a&gt;. These are also bookmarked in &lt;a href=&#34;http://del.icio.us/slowe&#34;&gt;my del.icio.us&lt;/a&gt; bookmark list under the &lt;a href=&#34;http://del.icio.us/slowe/Linux&#34;&gt;Linux&lt;/a&gt; tag.&lt;/p&gt;

&lt;p&gt;It looks as if the best solution involves the use of &lt;a href=&#34;http://web.mit.edu/kerberos/www&#34;&gt;Kerberos&lt;/a&gt; for authentication and LDAP for user/group name resolution. As fate would have it, as soon as I decide to use Kerberos, some &lt;a href=&#34;http://www.eweek.com/article2/0,1759,1836591,00.asp&#34;&gt;new security holes&lt;/a&gt; are discovered. At least these security holes don&amp;rsquo;t involve Microsoft&amp;rsquo;s implementation of Kerberos, but they will affect the Linux Kerberos clients. Hopefully, patches for the affected portions will be released reasonably quickly.&lt;/p&gt;

&lt;p&gt;As this project evolves, I&amp;rsquo;ll continue to post more information here. A final &amp;ldquo;how to&amp;rdquo; will likely also be posted on the &lt;a href=&#34;http://www.mercurionsystems.com/&#34;&gt;Mercurion Systems web site&lt;/a&gt; as well.&lt;/p&gt;
</description>
        </item>
      
    
      
        <item>
          <title>A New Effort</title>
          <link>http://lowescott.github.io/2005/07/09/a-new-effort/</link>
          <pubDate>Sat, 09 Jul 2005 23:09:53 &#43;0000</pubDate>
          <author>Scott Lowe</author>
          <guid>http://lowescott.github.io/2005/07/09/a-new-effort/</guid>
          <description>&lt;p&gt;I suppose I should be finishing one project before starting another, but I can&amp;rsquo;t help myself. I&amp;rsquo;m going to take on the project of integrating my Linux systems with Microsoft Active Directory, so that a single Active Directory account can be used to authenticate to both Windows-based systems as well as Linux-based systems on our network.&lt;/p&gt;

&lt;p&gt;This new effort comes while I have yet to finish my &lt;a href=&#34;http://blog.scottlowe.org/2005/05/13/miscellaneous-projects/&#34;&gt;projects&lt;/a&gt; on Squid log analysis tools or an internal news server running INN. At least I did get &lt;a href=&#34;http://blog.scottlowe.org/2005/05/15/perdition-working-now/&#34;&gt;Perdition working&lt;/a&gt; as expected, and figured out how to get &lt;a href=&#34;http://blog.scottlowe.org/2005/07/02/starttls-and-imap-in-mailapp/&#34;&gt;Mail.app to use STARTTLS with IMAP4&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A couple of the resources I&amp;rsquo;m using for this effort are bookmarked in my &lt;a href=&#34;http://del.icio.us/slowe/&#34;&gt;del.icio.us&lt;/a&gt; bookmark list. I&amp;rsquo;ll be adding more there as I find them.&lt;/p&gt;

&lt;p&gt;I also have yet to decide if I will use Samba/Winbind or LDAP to handle the cross-platform authentication. I&amp;rsquo;d love to hear any comments or feedback in this regard.&lt;/p&gt;
</description>
        </item>
      
    

  </channel>
</rss>
